<?php
/**
 * Generated by Haxe 4.3.7
 */

namespace src;

use \php\Boot;
use \haxe\Exception;
use \src\ast\Parameter;

class NativeFunction {
	/**
	 * @var \Closure
	 */
	public $body;
	/**
	 * @var string
	 */
	public $name;
	/**
	 * @var Parameter[]|\Array_hx
	 */
	public $params;

	/**
	 * @param string $name
	 * @param Parameter[]|\Array_hx $params
	 * @param \Closure $body
	 * 
	 * @return void
	 */
	public function __construct ($name, $params, $body) {
		#src/Interpreter.hx:55: characters 9-25
		$this->name = $name;
		#src/Interpreter.hx:56: characters 9-29
		$this->params = $params;
		#src/Interpreter.hx:57: characters 9-25
		$this->body = $body;
	}

	/**
	 * @param mixed[]|\Array_hx $args
	 * @param Interpreter $interp
	 * 
	 * @return mixed
	 */
	public function call ($args, $interp) {
		#src/Interpreter.hx:66: characters 9-46
		$previousEnv = $interp->environment;
		#src/Interpreter.hx:67: characters 9-58
		$interp->environment = new Environment($previousEnv);
		#src/Interpreter.hx:68: characters 19-23
		$_g = 0;
		#src/Interpreter.hx:68: characters 23-36
		$_g1 = $this->params->length;
		#src/Interpreter.hx:68: lines 68-81
		while ($_g < $_g1) {
			#src/Interpreter.hx:68: characters 19-36
			$i = $_g++;
			#src/Interpreter.hx:69: characters 13-35
			$param = ($this->params->arr[$i] ?? null);
			#src/Interpreter.hx:70: characters 13-38
			$value = null;
			#src/Interpreter.hx:72: lines 72-78
			if ($i < $args->length) {
				#src/Interpreter.hx:73: characters 17-32
				$value = ($args->arr[$i] ?? null);
			} else if ($param->defaultValue !== null) {
				#src/Interpreter.hx:75: characters 17-61
				$value = $interp->visitExpr($param->defaultValue);
			} else {
				#src/Interpreter.hx:77: characters 17-22
				throw Exception::thrown("Missing argument for parameter '" . ($param->name??'null') . "'");
			}
			#src/Interpreter.hx:80: characters 13-57
			$interp->environment->define($param->name, $value);
		}
		#src/Interpreter.hx:83: characters 9-54
		$value = ($this->body)($interp->environment);
		#src/Interpreter.hx:84: characters 9-41
		$interp->environment = $previousEnv;
		#src/Interpreter.hx:85: characters 9-21
		return $value;
	}

	/**
	 * @return string
	 */
	public function toString () {
		#src/Interpreter.hx:61: characters 9-70
		return "<Native function " . ($this->name??'null') . ":" . ($this->params->length??'null') . ">";
	}

	public function __toString() {
		return $this->toString();
	}
}

Boot::registerClass(NativeFunction::class, 'src.NativeFunction');
